{% extends 'jokerank/base.html' %}

{% block stat-nav %}class="active"{% endblock %}

{% block title %}Joke Stats{% endblock %}

{% block content %}
<h2>JokeDB Overview</h2>
<hr>

<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#jokes">Jokes</a></li>
    <li><a data-toggle="tab" href="#ratings">Ratings</a></li>
    <li><a data-toggle="tab" href="#raters">Raters</a></li>
</ul>

<div class="tab-content">
    <div id="jokes" class="tab-pane fade in active">
        {% include 'stats/joke-stats.html' %}
    </div>

    <div id="ratings" class="tab-pane fade">
        {% include 'stats/rating-stats.html' %}
    </div>
    <div id="raters" class="tab-pane fade">
        {% include 'stats/rater-stats.html' %}
    </div>
</div>



{% endblock %}



{% block scripts %}
<script type="text/javascript">

    function createBarChart(x, y, title, containerID) {
        var data = [{
            x: x,
            y: y,
            type: 'bar',
            name: name
        }];
        var layout = {
            title: title,

        };
        Plotly.newPlot(containerID, data, layout, {displayModeBar: false});
    }

    function createHistogram(x, y, title, containerID) {
        var data = [{
            x: x,
            y: y,
            type: 'histogram',
            name: name
        }];
        var layout = {
            title: title,
        };
        Plotly.newPlot(containerID, data, layout, {displayModeBar: false});
    }

    $(document).ready(function() {
        // joke charts
        createBarChart({{ joke_category_x|safe }}, {{ joke_category_y|safe }}, 'Joke vs. Category', 'joke_vs_category_chart');
        createBarChart({{ joke_type_x|safe }}, {{ joke_type_y|safe }}, 'Joke vs. Type', 'joke_vs_type_chart');
        createBarChart({{ joke_source_x|safe }}, {{ joke_source_y|safe }}, 'Joke vs. Source', 'joke_vs_source_chart');

        // rating charts
        createBarChart({{ num_rating_category_x|safe }}, {{ num_rating_category_y|safe }}, 'Number of Ratings by Category', 'rating_category_count_dist');
        createBarChart({{ num_rating_type_x|safe }}, {{ num_rating_type_y|safe }}, 'Number of Ratings by Type', 'rating_type_count_dist');
        createHistogram({{ avg_rating_category_x|safe }}, {{ avg_rating_category_y|safe }}, 'Average Rating by Category', 'rating_category_avg_dist');
        createHistogram({{ avg_rating_type_x|safe }}, {{ avg_rating_type_y|safe }}, 'Average Rating by Type', 'rating_type_avg_dist');

        // rater charts
        createBarChart({{ preferred_joke_genre_x|safe }}, {{ preferred_joke_genre_y|safe }}, 'Preferred Joke Genre', 'preferred_joke_genre');
        createBarChart({{ preferred_joke_type_x|safe }}, {{ preferred_joke_type_y|safe }}, 'Preferred Joke Type', 'preferred_joke_type');
        
        // createBarChart({{ joke_category_x|safe }}, {{ joke_category_y|safe }}, 'Joke vs. Category', 'joke_vs_category_chart');
        // createBarChart({{ joke_category_x|safe }}, {{ joke_category_y|safe }}, 'Joke vs. Category', 'joke_vs_category_chart');

                // window.onresize = function() {
        //     console.log('#' + containerID)
        //     var gd3 = Plotly.d3.select('#' + containerID);
        //     var gd = gd3.node();
        //     Plotly.Plots.resize(gd);
        // };
    });
    window.onresize = function() {
        var gd3 = Plotly.d3.select('#joke_vs_category_chart');
        var gd = gd3.node();
        Plotly.Plots.resize(gd);
        var gd3 = Plotly.d3.select('#joke_vs_type_chart');
        gd = gd3.node();
        Plotly.Plots.resize(gd);
        var gd3 = Plotly.d3.select('#joke_vs_source_chart');
        gd = gd3.node();
        Plotly.Plots.resize(gd);
    };

</script>
{% endblock %}


{% block styles %}
<style>
    .col-centered {
        float: none;
        margin: 0 auto;
    }

    .db-count {
        color: green;

    }
</style>
{% endblock %}
